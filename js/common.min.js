function Emiya(){this.listen()}function initPageShare(){var t=$(".J_share"),e=$(".J_share_wechat"),a=e.data("url"),n=e.data("avatar"),o=encodeURIComponent(e.data("title")+" - "+e.data("blogtitle")),i=encodeURIComponent(a),r={};r.weibo="http://v.t.sina.com.cn/share/share.php?title="+o+"&url="+i+"&pic="+n,r.qzone="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+i+"&sharesource=qzone&title="+o+"&pics="+n,r.twitter="https://twitter.com/intent/tweet?status="+o+" "+i,t.on("click",(function(){var t=$(this).data("type");if(t)return"wechat"===t?(0===e.find("canvas").length?$.ajax({method:"GET",url:Label.staticServePath+"/js/lib/jquery.qrcode.min.js",dataType:"script",cache:!0,success:function(){e.qrcode({width:128,height:128,text:a})}}):e.find("canvas").slideToggle(),!1):void window.open(r[t],"_blank","top=100,left=200,width=648,height=618")}))}function initContents(){var t={h1:5,h2:4,h3:3,h4:2,h5:1},e=getArticleTitles();if(0!==e.length){var a,n,o='<ul class="article__contents">';e.each((function(i,r){var s=t[r.tagName.toLowerCase()],c=e.eq(i).text(),l=$('<i><li><a href="javascript:void(0);" data-target="#'+e.eq(i).attr("id")+'"></a></li></i>');l.find("a").text(c);var h=l.html();s&&(n?s===a?o+=h:s<a?o+=Array(a-s).fill("<ul>").join("")+h:s>a&&(o+=Array(s-a).fill("</ul>").join("")+h):(o+=h,n=s),a=s)})),o+=Array(n-a+1).fill("</ul>").join(""),$(".J_article__contents--container").append(o)}else $(".J_article__contents").hide()}var getArticleTitles=function(){var t=null;return function(){if(null!==t)return t;var e=$("[id^=b3_solo_h]");return t=e}}();function ScrollManagerCreator(t){var e=t,a=$(".J_navbar"),n=$(".toTop"),o=$(".J_article__contents"),i=$(".J_article__content"),r=100;function s(t){var n=a.height()+1;t>n?a.addClass("is-fixed").css("top",-1*n):t<=0&&a.removeClass("is-fixed").css("top",0),a.hasClass("is-fixed")&&(t>e?a.removeClass("show"):a.addClass("show"))}function c(t){t>r?n.fadeIn():n.fadeOut()}function l(t){if(!(o.length<=0)){var e=o.prev(),n=o.height(),r=e.offset().top+e.height(),s=a.height()+1,c=i.offset().top+i.height()-n+s;t<=r-s?o.css("position","static"):t>r-s&&t<c-s?o.css({position:"fixed",top:s}):o.css({position:"absolute",top:c})}}function h(t){for(var e,n=a.height()+1,o=$(".J_article__contents--container a"),i=0;i<o.length;i++){var r=o.eq(i).attr("data-target");t+n>$(r).offset().top&&(e=i)}o.removeClass("active"),o.eq(e).addClass("active")}return s(e),c(e),l(e),h(e),function(t){s(t),c(t),l(t),h(t),e=t}}function scrollTo(t){$("html ,body").animate({scrollTop:t},300)}var scrollManager=ScrollManagerCreator($(window).scrollTop());Emiya.prototype.listen=function(){$(".J_navbar_toggle").on("click",(function(){var t="."+$(this).attr("data-for");$(t).hasClass("show")?$(t).removeClass("show"):$(t).addClass("show")})),$(".J_replyName").on("click",(function(){var t=$(this).attr("data-originalId");$("#"+t)[0].scrollIntoViewIfNeeded(!0),$("#"+t).addClass("blink"),setTimeout((function(){$("#"+t).removeClass("blink")}),3e3)})),$(".J_backToTop").on("click",(function(t){scrollTo(0),t.preventDefault()})),$(window).on("scroll",(function(){var t=$(window).scrollTop();scrollManager(t)})),$("body").on("click",".J_article__contents--container a",(function(){var t=$(this).attr("data-target");scrollTo($(t).offset().top-$(".J_navbar").height()+1)})),$("body").on("touchstart",(function(){}))},Emiya.prototype.initArticle=function(){initPageShare();try{initContents()}catch(t){console.error(t)}},window.Skin=new Emiya;