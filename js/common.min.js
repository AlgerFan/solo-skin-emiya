function Emiya(){this.listen()}function initPageShare(){var t=$(".J_share"),e=$(".J_share_wechat"),a=e.data("url"),n=e.data("avatar"),o=encodeURIComponent(e.data("title")+" - "+e.data("blogtitle")),i=encodeURIComponent(a),r={};r.weibo="http://v.t.sina.com.cn/share/share.php?title="+o+"&url="+i+"&pic="+n,r.qzone="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+i+"&sharesource=qzone&title="+o+"&pics="+n,r.twitter="https://twitter.com/intent/tweet?status="+o+" "+i,t.on("click",function(){var t=$(this).data("type");if(t)return"wechat"===t?(0===e.find("canvas").length?$.ajax({method:"GET",url:Label.staticServePath+"/js/lib/jquery.qrcode.min.js",dataType:"script",cache:!0,success:function(){e.qrcode({width:128,height:128,text:a})}}):e.find("canvas").slideToggle(),!1):void window.open(r[t],"_blank","top=100,left=200,width=648,height=618")})}function initContents(){var i={h1:5,h2:4,h3:3,h4:2,h5:1},r=getArticleTitles();if(0!==r.length){var s,c,l='<ul class="article__contents">';r.each(function(t,e){var a=i[e.tagName.toLowerCase()],n=r.eq(t).text(),o='<li><a href="javascript:void(0);" data-target="#'+r.eq(t).attr("id")+'">'+n+"</a></li>";a&&(c?a===s?l+=o:a<s?l+=Array(s-a).fill("<ul>").join("")+o:s<a&&(l+=Array(a-s).fill("</ul>").join("")+o):(l+=o,c=a),s=a)}),l+=Array(c-s+1).fill("</ul>").join(""),$(".J_article__contents--container").append(l)}else $(".J_article__contents").hide()}document.body.addEventListener("touchstart",function(){});var getArticleTitles=function(){var e=null;return function(){if(null!==e)return e;var t=$("[id^=b3_solo_h]");return e=t}}();function ScrollManagerCreator(t){var e,a=t,r=$(".J_navbar"),n=$(".toTop"),o=$(".J_article__contents");function i(t){var e=r.height()+1;e<t?r.addClass("is-fixed").css("top",-1*e):t<=0&&r.removeClass("is-fixed").css("top",0),r.hasClass("is-fixed")&&(a<t?r.removeClass("show"):r.addClass("show"))}function s(t){100<t?n.fadeIn():n.fadeOut()}function c(t){if(!(o.length<=0)){var e=o.prev(),a=e.offset().top+e.height(),n=r.height()+1;a-n<t?o.css({position:"fixed",top:n}):o.css("position","static")}}function l(i){clearTimeout(e),e=setTimeout(function(){for(var t,e=r.height()+1,a=$(".J_article__contents--container a"),n=0;n<a.length;n++){var o=a.eq(n).attr("data-target");i+e>$(o).offset().top&&(t=n)}a.removeClass("active"),a.eq(t).addClass("active")},50)}return i(a),s(a),c(a),l(a),function(t){i(t),s(t),c(t),l(t),a=t}}function scrollTo(t){$("html ,body").animate({scrollTop:t},300)}var scrollManager=ScrollManagerCreator($(window).scrollTop());Emiya.prototype.listen=function(){$(".J_navbar_toggle").on("click",function(){var t="."+$(this).attr("data-for");$(t).hasClass("show")?$(t).removeClass("show"):$(t).addClass("show")}),$(".J_replyName").on("click",function(){var t=$(this).attr("data-originalId");$("#"+t)[0].scrollIntoViewIfNeeded(!0),$("#"+t).addClass("blink"),setTimeout(function(){$("#"+t).removeClass("blink")},3e3)}),$(".J_backToTop").on("click",function(t){scrollTo(0),t.preventDefault()}),$(window).on("scroll",function(){var t=$(window).scrollTop();scrollManager(t)}),$("body").on("click",".J_article__contents--container a",function(){var t=$(this).attr("data-target");scrollTo($(t).offset().top-$(".J_navbar").height()+1)})},Emiya.prototype.initArticle=function(){initPageShare();try{initContents()}catch(t){console.error(t)}},window.Skin=new Emiya;